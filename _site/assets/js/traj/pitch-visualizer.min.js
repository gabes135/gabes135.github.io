const button_ids=["z_p","z_n","x_g","x_a"],pitchNames={FF:"Four-Seam Fastball",FT:"Two-Seam Fastball",SI:"Sinker",SL:"Slider",CU:"Curveball",CH:"Changeup",KC:"Knuckle Curve",EP:"Eephus",SC:"Screwball",KN:"Knuckleball",FS:"Splitter",ST:"Sweeper",SV:"Slurve",UN:"Unknown"};let pitch_state,dropdownConfig=[],datasets={},data_folder="";function getPitchName(t){return pitchNames[t]||"Unknown Pitch"}function getStaticInfo(t){const e=t.player_name;let n=e;if("string"==typeof e&&e.includes(",")){const[t,a]=e.split(",").map(t=>t.trim());n=`${a} ${t}`}Math.round(100*parseFloat(t[`eta_${t.pitch_type}`])),Math.round(t.spin_axis);return`\n  <div class="pitch-info-boxes">\n    <div class="info-box">\n      <strong>Pitcher</strong>\n      <div>${n} (${t.p_throws})</div>\n    </div>\n    <div class="info-box">\n      <strong>Pitch Type</strong>\n      <div>${getPitchName(t.pitch_type)}</div>\n    </div>\n    <div class="info-box">\n      <strong>Release Speed</strong>\n      <div>${t.release_speed} MPH</div>\n    </div>\n  </div>\n`}function getDynamicInfo(t,e,n){let a=Math.round(100*parseFloat(t[`eta_${t.pitch_type}`])),o=Math.round(t.spin_axis);return`\n      <h3 style="text-align: center;"><strong>Movement Information</strong></h3>\n      <p><strong>Spin Rate:</strong> ${Math.round(t.release_spin_rate)} RPM</p>\n      <p><strong>Spin Axis:</strong> ${o}&deg</p>\n      <p><strong>Spin Efficiency:</strong> ${a}%</p>\n      <p><strong>Induced Vertical Break:</strong> ${e} in.</p>\n      <p><strong>Horizontal Break:</strong> ${n} in.</p>\n    `}async function fileExists(t){try{return(await fetch(t,{method:"HEAD"})).ok}catch{return!1}}async function getDataFolder(){const t=new Date,e=new Date(t);e.setDate(e.getDate()-1);const n=`../assets/savant_data/${`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}`;return await fileExists(`${n}/data_z_pos.csv`)?n:"../assets/savant_data/backup"}async function initDropdownConfig(){data_folder=await getDataFolder(),dropdownConfig=[{id:"z_p",label:"Rise",csv:`${data_folder}/data_z_pos.csv`},{id:"z_n",label:"Drop",csv:`${data_folder}/data_z_neg.csv`},{id:"x_g",label:"Glove Side Break",csv:`${data_folder}/data_x_glove.csv`},{id:"x_a",label:"Arm Side Break",csv:`${data_folder}/data_x_arm.csv`}],console.log("Using data folder:",data_folder),console.log("Dropdown config:",dropdownConfig)}function createMenuBar(){const t=document.getElementById("menu-bar");t.innerHTML="",dropdownConfig.forEach(e=>{const n=document.createElement("div");n.className="dropdown",n.innerHTML=`\n      <button onclick="toggleDropdown('${e.id}')" class="dropbtn">\n        ${e.label}\n        <img src="../assets/images/down.png" alt="â–¼" style="width:20px; height:20px;\n         vertical-align:middle;padding-bottom:4px; pointer-events: none;">\n      </button>\n      <div id="myDropdown_${e.id}" class="dropdown-content"></div>\n    `,t.appendChild(n),parse_csv(`myDropdown_${e.id}`,e.csv)})}function toggleDropdown(t){const e=document.getElementById(`myDropdown_${t}`),n=e.classList.contains("show");button_ids.forEach(t=>document.getElementById(`myDropdown_${t}`).classList.remove("show")),n||e.classList.add("show"),"function"==typeof gtag&&gtag("event","dropdown_click",{event_category:"viz_dropdowns",event_label:t})}function showRow(t,e){const n=document.getElementById("output"),a=document.getElementById("dynamic-output");document.getElementById("dateDisplay").innerText="../assets/savant_data/backup"==data_folder?`Selection of pitches from ${t.game_date.slice(0,4)} season`:`Last updated ${t.game_date}`;const o=(12*parseFloat(t.pfx_z)).toFixed(2),s=Math.abs(12*parseFloat(t.pfx_x)).toFixed(2);n.innerHTML=getStaticInfo(t),a.innerHTML=getDynamicInfo(t,o,s),pitch_state=plot_traj(t,!0),animatePitch(pitch_state.omega_hat,parseFloat(t.release_spin_rate))}function filterFunction(t){let e,n,a,o;for(e=document.getElementById(`myInput_${t}`),n=e.value.toUpperCase(),div=document.getElementById(t),a=div.getElementsByTagName("a"),o=0;o<a.length;o++)txtValue=a[o].textContent||a[o].innerText,txtValue.toUpperCase().indexOf(n)>-1?a[o].style.display="":a[o].style.display="none"}function parse_csv(t,e){Papa.parse(e,{download:!0,header:!0,complete:function(e){datasets[t]=e.data;const n=document.getElementById(t);n.innerHTML="";const a=document.createElement("input");a.type="text",a.placeholder="Search...",a.id=`myInput_${t}`,a.onkeyup=()=>filterFunction(t),n.appendChild(a),datasets[t].forEach((e,a)=>{const o=document.createElement("a");let s="",d="";"myDropdown_x_g"==t||"myDropdown_x_a"==t?(s=(12*parseFloat(e.pfx_x)).toFixed(1),d="HB"):(s=(12*parseFloat(e.pfx_z)).toFixed(1),d="IVB");let i=e.player_name;if("string"==typeof i&&i.includes(",")){const[t,e]=i.split(",").map(t=>t.trim());i=`${e} ${t}`}o.textContent=`${i} - ${e.pitch_type} - ${d}: ${s} in.`,o.href="#",o.dataset.index=a,o.addEventListener("click",function(e){e.preventDefault();const n=parseInt(this.dataset.index);showRow(datasets[t][n],t)}),n.appendChild(o)}),datasets[t].length&&"myDropdown_z_p"==t&&showRow(datasets[t][0],t)}})}window.onclick=function(t){t.target.matches(".dropbtn")||"INPUT"===t.target.tagName||document.querySelectorAll(".dropdown-content").forEach(t=>t.classList.remove("show"))};const cameraButton=document.getElementById("cameraButtonId");cameraButton.addEventListener("click",resetCamera);const cameraDPButton=document.getElementById("cameraDPButtonId");async function main(){await initDropdownConfig(),createMenuBar()}cameraDPButton.addEventListener("click",dpCamera),main();
const button_ids=["pid","ptype","date","pitches"],pitchNames={FF:"Four-Seam Fastball",FC:"Cutter",FT:"Two-Seam Fastball",SI:"Sinker",SL:"Slider",CU:"Curveball",CH:"Changeup",KC:"Knuckle Curve",EP:"Eephus",SC:"Screwball",KN:"Knuckleball",FS:"Splitter",ST:"Sweeper",SV:"Slurve",UN:"Unknown"};let pitch_state,dropdownConfig=[],datasets={},data_folder="",payload={first_name:"Tarik",last_name:"Skubal",ptype:"CH",start_date:"2025-09-28",end_date:"2025-10-01"},payloadDisplay=document.createElement("div");function fillPayLoad(e,t){payload[e]=t}function getPitchName(e){return pitchNames[e]||"Unknown Pitch"}function getStaticInfo(e){const t=e.player_name;let n=t;if("string"==typeof t&&t.includes(",")){const[e,a]=t.split(",").map(e=>e.trim());n=`${a} ${e}`}Math.round(100*parseFloat(e[`eta_${e.pitch_type}`])),Math.round(e.spin_axis);return`\n    <div class="pitch-info-boxes">\n      <div class="info-box">\n        <strong>Pitcher</strong>\n        <div>${n} (${e.p_throws})</div>\n      </div>\n      <div class="info-box">\n        <strong>Pitch Type</strong>\n        <div>${getPitchName(e.pitch_type)}</div>\n      </div>\n      <div class="info-box">\n        <strong>Release Speed</strong>\n        <div>${e.release_speed} MPH</div>\n      </div>\n    </div>\n  `}function getDynamicInfo(e,t,n){let a=Math.round(100*parseFloat(e[`eta_${e.pitch_type}`])),o=Math.round(e.spin_axis);return`\n      <h3 style="text-align: center;"><strong>Movement Information</strong></h3>\n      <p><strong>Spin Rate:</strong> ${Math.round(e.release_spin_rate)} RPM</p>\n      <p><strong>Spin Axis:</strong> ${o}&deg</p>\n      <p><strong>Spin Efficiency:</strong> ${a}%</p>\n      <p><strong>Induced Vertical Break:</strong> ${t} in.</p>\n      <p><strong>Horizontal Break:</strong> ${n} in.</p>\n    `}async function initDropdownConfig(){dropdownConfig=[{id:"pid",label:"Player Name",csv:"../assets/savant_data/eta.csv"}]}function createMenuBar(){const e=document.getElementById("menu-bar"),t=document.getElementById("menu-bar-bottom");e.innerHTML="",t.innerHTML="";const n=document.createElement("div");n.className="dropdown",n.innerHTML='\n    <button onclick="toggleDropdown(\'pid\')" class="dropbtn">\n      Player Name\n      <img src="../assets/images/down.png" alt="▼" style="width:20px; height:20px;\n       vertical-align:middle;padding-bottom:4px; pointer-events: none;">\n    </button>\n    <div id="myDropdown_pid" class="dropdown-content-search"></div>\n  ',e.appendChild(n),parse_eta("myDropdown_pid","../assets/savant_data/eta.csv");const a=document.createElement("div");a.setAttribute("id","ptypeMenu"),a.className="dropdown",a.innerHTML='\n    <button onclick="toggleDropdown(\'ptype\')" class="dropbtn">\n      Pitch Type:\n      <img src="../assets/images/down.png" alt="▼" style="width:20px; height:20px;\n       vertical-align:middle;padding-bottom:4px; pointer-events: none;">\n    </button>\n    <div id="myDropdown_ptype" class="dropdown-content-search"></div>\n  ',e.appendChild(a);const o=document.createElement("div");o.setAttribute("id","date"),o.className="dropdown",o.innerHTML='\n    <button onclick="toggleDropdown(\'date\')" class="dropbtn">\n      Date:\n      <img src="../assets/images/down.png" alt="▼" style="width:20px; height:20px;\n       vertical-align:middle;padding-bottom:4px; pointer-events: none;">\n    </button>\n    <div id="myDropdown_date" class="dropdown-content-search"></div>\n  ',e.appendChild(o);const d=document.getElementById("myDropdown_date"),s=new dhx.Calendar(d,{dateFormat:"%Y-%m-%d",css:"dhx_widget--bordered",range:!0});s.events.on("change",function(){const e=s.getValue();[start,end]=e,fillPayLoad("start_date",start),fillPayLoad("end_date",end),void 0!==end&&d.classList.remove("show")}),e.appendChild(payloadDisplay);const i=document.createElement("div");i.className="dropdown",i.innerHTML='\n      <button onclick="toggleDropdown(\'pitches\')" class="dropbtn">\n        Pitches\n        <img src="../assets/images/down.png" alt="▼" style="width:20px; height:20px;\n         vertical-align:middle;padding-bottom:4px; pointer-events: none;">\n      </button>\n      <div id="myDropdown_pitches" class="dropdown-content-pitches"></div>\n    ',t.appendChild(i)}function toggleDropdown(e){const t=document.getElementById(`myDropdown_${e}`),n=t.classList.contains("show");button_ids.forEach(e=>document.getElementById(`myDropdown_${e}`).classList.remove("show")),n||t.classList.add("show")}function selectPitcher(e,t){const n=document.getElementById("myDropdown_ptype");n.replaceChildren();document.getElementById("ptypeMenu");let a=Object.keys(e).filter(t=>t.startsWith("eta_")&&""!==e[t]).map(e=>e.slice(4));a.map(e=>getPitchName(e)).forEach((e,t)=>{const o=document.createElement("a");o.textContent=`${e}`,o.href="#",o.dataset.index=t,o.addEventListener("click",function(e){e.preventDefault();parseInt(this.dataset.index);fillPayLoad("ptype",a[t])}),n.appendChild(o)})}function showRow(e,t){const n=document.getElementById("output"),a=document.getElementById("dynamic-output");console.log("row",e);const o=(12*parseFloat(e.pfx_z)).toFixed(2),d=Math.abs(12*parseFloat(e.pfx_x)).toFixed(2);n.innerHTML=getStaticInfo(e),a.innerHTML=getDynamicInfo(e,o,d),pitch_state=plot_traj(e,!0),animatePitch(pitch_state.omega_hat,parseFloat(e.release_spin_rate))}function filterFunction(e){let t,n,a,o;for(t=document.getElementById(`myInput_${e}`),n=t.value.toUpperCase(),div=document.getElementById(e),a=div.getElementsByTagName("a"),o=0;o<a.length;o++)txtValue=a[o].textContent||a[o].innerText,txtValue.toUpperCase().indexOf(n)>-1?a[o].style.display="":a[o].style.display="none"}function parse_query(e,t){const n=document.getElementById(e);n.innerHTML="";const a=document.createElement("input");a.type="text",a.placeholder="Search...",a.id=`myInput_${e}`,a.onkeyup=()=>filterFunction(e),n.appendChild(a),t.forEach((a,o)=>{const d=document.createElement("a");let s=(12*parseFloat(a.pfx_x)).toFixed(1),i=(12*parseFloat(a.pfx_z)).toFixed(1),r=parseFloat(a.release_speed).toFixed(1),p=a.des;d.textContent=`${p} | ${r} MPH | HB: ${s} in. | IVB: ${i} in.`,d.href="#",d.dataset.index=o,d.addEventListener("click",function(n){n.preventDefault();const a=parseInt(this.dataset.index);showRow(t[a],e)}),n.appendChild(d)}),t.length&&showRow(t[0],e)}function parse_eta(e,t){Papa.parse(t,{download:!0,header:!0,complete:function(t){eta=t.data;const n=document.getElementById(e);n.innerHTML="";const a=document.createElement("input");a.type="text",a.placeholder="Search...",a.id=`myInput_${e}`,a.onkeyup=()=>filterFunction(e),n.appendChild(a),eta.forEach((t,a)=>{const o=document.createElement("a");let d,s,i=t.entity_name;"string"==typeof i&&i.includes(",")&&([d,s]=i.split(",").map(e=>e.trim()),i=`${s} ${d}`),o.textContent=`${i}`,o.href="#",o.dataset.index=a,o.addEventListener("click",function(t){t.preventDefault();const n=parseInt(this.dataset.index);selectPitcher(eta[n],e),fillPayLoad("first_name",s),fillPayLoad("last_name",d),fillPayLoad("ptype","_")}),n.appendChild(o)})}})}function displayPayload(){payloadDisplay.innerHTML=`\n      <span class="payload-name">${payload.first_name} ${payload.last_name}</span>\n      <span class="payload-separator">|</span>\n      <span class="payload-ptype">${payload.ptype}</span>\n      <span class="payload-separator">|</span>\n      <span class="payload-dates">${payload.start_date} → ${payload.end_date}</span>\n    `}payloadDisplay.id="payload-display",payloadDisplay.className="payload-container",window.addEventListener("click",function(e){document.querySelectorAll(".dropdown-content-search, .dropdown-content-pitches").forEach(t=>{"A"===e.target.tagName&&t.contains(e.target)?(t.classList.remove("show"),displayPayload()):e.target.matches(".dropbtn")||t.contains(e.target)||(t.classList.remove("show"),displayPayload())})});const queryBtn=document.querySelector(".query-btn"),loadingIcon=document.getElementById("loadingIcon");async function runQuery(e){try{loadingIcon.classList.add("active");const t=await fetch("https://0inxxvmk0b.execute-api.us-east-2.amazonaws.com/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){console.log("Error: "+e.message)}finally{loadingIcon.classList.remove("active")}}queryBtn.addEventListener("click",async function(){if(Object.values(payload).every(e=>"_"!==e)){parse_query("myDropdown_pitches",await runQuery(payload))}else console.log("Some fields are missing or empty.")});const cameraButton=document.getElementById("cameraButtonId");cameraButton.addEventListener("click",resetCamera);const cameraDPButton=document.getElementById("cameraDPButtonId");async function main(){await initDropdownConfig(),createMenuBar(),displayPayload();parse_query("myDropdown_pitches",await runQuery(payload))}cameraDPButton.addEventListener("click",dpCamera),main();